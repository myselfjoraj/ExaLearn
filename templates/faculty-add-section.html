{% extends "faculty-base.html" %}

{% block content %}

{% block header %}
<h1 hidden="hidden"> {% block title %} Add Section {% endblock %} </h1>
{% endblock %}

<div class="pt-32pt">
    <div class="container-fluid page__container d-flex flex-column flex-md-row align-items-center text-center text-sm-left">
        <div class="flex d-flex flex-column flex-sm-row align-items-center">
            <div class="mb-24pt mb-sm-0 mr-sm-24pt">
                <h2 class="mb-0">Add / Edit Section</h2>
            </div>
        </div>
    </div>
</div>

<div class="page-section">
    <div class="container-fluid page__container">
        <div class="row">
            <div class="col-md-8">
                <div class="page-separator">
                    <div class="page-separator__text">Basic information</div>
                </div>
                <label class="form-label">Section title</label>
                <div class="form-group mb-24pt">
                    <input type="text" class="form-control form-control-lg" placeholder="Section title" value="" id="sectionTitle">
                </div>
                <div class="page-separator">
                    <div class="page-separator__text">Contents</div>
                </div>
                <div class="accordion js-accordion accordion--boxed mb-24pt" id="parent">
                    <div class="accordion__item open">
                        <div class="accordion__menu collapse show" id="course-toc-2">
                            {% if content_list %}
                                {% for content in content_list %}
                                <div class="accordion__menu-link" id="content-{{ loop.index }}">
                                    <a class="flex" href="student-lesson.html">{{ content.title }}</a>
                                    <span class="text-muted">{{ content.duration }} min</span>
                                    <span class="text-muted" style="color: red; margin-left: 20px; cursor: pointer;" onclick="deleteItem('{{ loop.index }}')"><b>DELETE</b></span>
                                </div>
                                {% endfor %}
                            {% endif %}
                        </div>
                    </div>
                </div>
                <a href="{{ url_for('faculty_course_add_section_content') }}" class="btn btn-outline-secondary mb-24pt mb-sm-0">Add Contents</a>
            </div>
            <div class="col-md-4">
                <div class="card">
                    <div class="card-header text-center">
                        <a href="/faculty/courses/add?list={{ content_list }}" id="saveSectionLink" class="btn btn-accent">Save Section</a>
                    </div>
                    <div class="list-group list-group-flush">
                        <div class="list-group-item">
                            <a href="#" onClick="history.go(-1); return false;" class="text-danger"><strong>Cancel</strong></a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    let content_list = {{ content_list | tojson | safe }};

    document.getElementById('saveSectionLink').addEventListener('click', function(event) {
        event.preventDefault(); // Prevent default anchor behavior
        let sectionTitle = document.getElementById('sectionTitle').value; // Get input field value
        let saveSectionLink = '/faculty/courses/add?list=' + encodeURIComponent(JSON.stringify(content_list)) + '&title=' + encodeURIComponent(sectionTitle);
        window.location.href = saveSectionLink; // Navigate to the new URL
    });

    function deleteItem(index) {
        // Confirm deletion (optional)
        if (confirm('Are you sure you want to delete this item?')) {
            // Remove the item from content_list
            content_list.splice(index - 1, 1); // Adjust index since Jinja starts index from 1
            // Update the UI
            refreshUI();
        }
    }

    function refreshUI() {
        // Get the accordion container
        let accordionMenu = document.getElementById('course-toc-2');
        // Clear existing content
        accordionMenu.innerHTML = '';
        // Rebuild the accordion content based on updated content_list
        content_list.forEach((content, index) => {
            let newItem = `
                <div class="accordion__menu-link" id="content-${index + 1}">
                    <a class="flex" href="student-lesson.html">${content.title}</a>
                    <span class="text-muted">${content.duration} min</span>
                    <span class="text-muted" style="color: red; margin-left: 20px; cursor: pointer;" onclick="deleteItem(${index + 1})"><b>DELETE</b></span>
                </div>`;
            accordionMenu.insertAdjacentHTML('beforeend', newItem);
        });
    }
</script>

{% endblock %}
